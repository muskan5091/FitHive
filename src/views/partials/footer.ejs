<footer>
  <!-- Chatbot widget (placed in footer) -->
  <style>
    /* chatbot styles - improved, responsive, and limited height */
    #chatbotButton {
      position: fixed;
      right: 18px;
      bottom: 18px;
      background: #a5683a;
      color: #fff;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      cursor: pointer;
      z-index: 20000;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }

    .chat-modal {
      position: fixed;
      right: 18px;
      bottom: 90px;                  /* stays above the floating button/footer */
      width: 360px;
      max-width: calc(100% - 36px);
      height: auto;
      max-height: 60vh;              /* prevents full-page coverage */
      min-height: 260px;
      display: none;                 /* toggled by JS via .open class */
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      overflow: hidden;
      z-index: 20000;
      flex-direction: column;
    }
    .chat-modal.open { display: flex; }

    .chat-header {
      background: #a5683a;
      color: #fff;
      padding: 12px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-body {
      flex: 1 1 auto;
      padding: 14px;
      overflow-y: auto;
      background: #f6f6f6;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .msg {
      display: flex;
      align-items: flex-end;
      gap: 8px;
      width: 100%;
    }

    .msg.bot { justify-content: flex-start; }
    .msg.user { justify-content: flex-end; }

    .bubble {
      max-width: 76%;
      padding: 10px 12px;
      border-radius: 12px;
      line-height: 1.35;
      word-break: break-word;
      white-space: pre-wrap;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
      font-size: 14px;
    }

    .msg.bot .bubble {
      background: #fff;
      color: #222;
      border: 1px solid #eaeaea;
      border-bottom-left-radius: 4px;
    }

    .msg.user .bubble {
      background: #a5683a;
      color: #fff;
      border-bottom-right-radius: 4px;
      text-align: right;
    }

    .avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      flex: 0 0 36px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #fff;
      font-size: 13px;
    }
    .avatar.bot { background: #e9e9e9; color: #222; }
    .avatar.user { background: #a5683a; }

    .chat-footer {
      padding: 10px;
      border-top: 1px solid #eee;
      display: flex;
      gap: 8px;
      background: #fff;
    }

    .chat-input {
      flex: 1;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #ddd;
      outline: none;
      font-size: 14px;
    }

    .chat-send {
      background: #a5683a;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
    }

    .chat-send:disabled { opacity: 0.7; cursor: default; }

    .chat-loading {
      font-size: 13px;
      color: #666;
      margin-top: 6px;
    }

    @media (max-width: 480px) {
      .chat-modal { right: 10px; left: 10px; width: auto; height: 60vh; bottom: 80px; }
      .bubble { font-size: 13px; }
    }
  </style>

  <div id="chatbotButton" aria-label="Open chat" title="Chat with us">ðŸ’¬</div>

  <div class="chat-modal" id="chatModal" role="dialog" aria-modal="true" aria-label="Chat with us" aria-hidden="true">
    <div class="chat-header">
      <div>Helper</div>
      <button id="closeChat" aria-label="Close chat" style="background:transparent;border:none;color:white;font-size:18px;cursor:pointer">âœ•</button>
    </div>

    <div class="chat-body" id="chatBody" aria-live="polite"></div>

    <div class="chat-footer">
      <input id="chatInput" class="chat-input" placeholder="Type a question..." autocomplete="off" aria-label="Chat message input" />
      <button id="chatSend" class="chat-send" aria-label="Send message">Send</button>
    </div>
  </div>

  <script>
    (function(){
      const btn = document.getElementById('chatbotButton');
      const modal = document.getElementById('chatModal');
      const closeBtn = document.getElementById('closeChat');
      const sendBtn = document.getElementById('chatSend');
      const input = document.getElementById('chatInput');
      const body = document.getElementById('chatBody');

      const INITIAL_MESSAGE = 'Hi â€” I can help with product info, orders or sizing. Ask me anything.';

      function open() {
        modal.classList.add('open');
        modal.setAttribute('aria-hidden', 'false');
        ensureInitialMessage();
        // focus input after small delay so mobile keyboards behave better
        setTimeout(() => input.focus(), 80);
      }
      function close() {
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden', 'true');
      }
      function isOpen() {
        return modal.classList.contains('open');
      }

      // toggle on floating button click
      btn.addEventListener('click', () => {
        if (isOpen()) close();
        else open();
      });

      // close button closes
      closeBtn.addEventListener('click', close);

      // allow ESC key to close
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && isOpen()) close();
      });

      // Add initial bot message only once
      function ensureInitialMessage() {
        const hasBot = body.querySelector('.msg.bot');
        if (!hasBot) appendMessage(INITIAL_MESSAGE, 'bot', true);
      }

      function appendMessage(text, who='bot', noAvatar=false) {
        const wrapper = document.createElement('div');
        wrapper.className = 'msg ' + (who === 'user' ? 'user' : 'bot');

        const avatar = document.createElement('div');
        avatar.className = 'avatar ' + (who === 'user' ? 'user' : 'bot');
        avatar.textContent = ''; // empty circle - you can add initials

        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        bubble.textContent = text;

        if (who === 'bot') {
          if (!noAvatar) wrapper.appendChild(avatar);
          wrapper.appendChild(bubble);
        } else {
          wrapper.appendChild(bubble);
          if (!noAvatar) wrapper.appendChild(avatar);
        }

        body.appendChild(wrapper);
        body.scrollTop = body.scrollHeight;
      }

      function showLoading() {
        const l = document.createElement('div');
        l.className = 'chat-loading';
        l.id = 'chatLoading';
        l.textContent = 'Typing...';
        body.appendChild(l);
        body.scrollTop = body.scrollHeight;
      }
      function hideLoading() {
        const l = document.getElementById('chatLoading');
        if (l) l.remove();
      }

      async function sendMessage() {
        const text = input.value.trim();
        if (!text) return;

        appendMessage(text, 'user');
        input.value = '';
        sendBtn.disabled = true;
        input.disabled = true;

        showLoading();

        try {
          const res = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: text })
          });

          const json = await res.json();
          hideLoading();

          const reply = (json && (json.reply || json.message || json.error)) || 'Sorry, no response.';
          appendMessage(reply, 'bot');

        } catch (err) {
          hideLoading();
          appendMessage('Network error â€” please try again.', 'bot');
          console.error(err);
        } finally {
          sendBtn.disabled = false;
          input.disabled = false;
          input.focus();
        }
      }

      sendBtn.addEventListener('click', sendMessage);
      input.addEventListener('keydown', (e) => { if (e.key === 'Enter') sendMessage(); });

      // ensure initial message exists (if modal opened programmatically)
      ensureInitialMessage();
    })();
  </script>

  <!-- keep your existing footer content below (unchanged) -->
  <center>
    <div class="footer-container">
      <div class="footer-section about">
        <h2 class="footer-logo">FIT<span>HIVE</span></h2>
        <p>Premium gym wear for your active lifestyle. Style meets performance.</p>
      </div>

      <div class="footer-section">
        <h3>SHOP</h3>
        <ul>
          <li><a href="/mens">Men's Collection</a></li>
          <li><a href="/womens">Women's Collection</a></li>
          <li><a href="/featured">Featured Items</a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h3>COMPANY</h3>
        <ul>
          <li><a href="/about">About Us</a></li>
          <li><a href="/contact">Contact</a></li>
          <li><a href="/privacy">Privacy Policy</a></li>
          <li><a href="/terms">Terms of Service</a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h3>FOLLOW US</h3>
        <ul class="social-links">
          <li><a href="#">Instagram</a></li>
          <li><a href="#">Facebook</a></li>
          <li><a href="#">Twitter</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>Â© 2025 FitHive. All rights reserved.</p>
    </div>
  </center>
</footer>
